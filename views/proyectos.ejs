<!-- proyectos.ejs -->

<h4 class="mb-4">Catálogo de Proyectos</h4>
<div id="seleccionProyecto" class="mb-3 text-muted fw-semibold"></div>

<div class="table-container">
  <button class="btn btn-primary mb-3" onclick="agregarFila()">
    Agregar Proyecto
  </button>

  <div class="table-responsive">
    <table
      id="tablaProyectos"
      class="table table-striped table-hover table-bordered"
      style="width: 100%"
    >
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Proyecto</th>
          <th>Descripción</th>
          <th>Tipo</th>
          <th>Departamento(s)</th>
          <th>Área(s)</th>
          <th>Integrante(s)</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>%</th>
          <th>Indicador</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="cuerpoTablaProyectos">
        <% proyectos.forEach((p, index) => { %>
        <tr
          data-bs-toggle="collapse"
          data-bs-target="#detalle<%= index %>"
          style="cursor: pointer"
        >
          <td><%= p.id %></td>
          <td><%= p.nombre %></td>
          <td><%= p.descripcion %></td>
          <td><%= p.tipo_proyecto %></td>
          <td><%= p.departamento %></td>
          <td><%= p.area %></td>
          <td><%= p.integrantes %></td>
          <td><%= p.fecha_inicio.toISOString().split('T')[0] %></td>
          <td><%= p.fecha_fin.toISOString().split('T')[0] %></td>
          <td><%= p.porcentaje %> %</td>
          <td><%= p.estatus %></td>
          <td>
            <button
              class="btn btn-sm btn-outline-warning"
              onclick="editarProyecto(this)"
              title="Editar"
            >
              <i class="bi bi-pencil-square"></i>
            </button>
          </td>
        </tr>

        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- Definimos la lista de integrantes como variable global JS -->
<script>

  const integrantes = <%- JSON.stringify(integrantes || []) %>;
  console.log("Integrantes disponibles:", integrantes); // Para depurar
</script>

<datalist id="listaIntegrantes">
  <% integrantes.forEach(p => { %>
  <option
    value="<%= p.nombre_sin_apellidos %> <%= p.apellido_paterno %> <%= p.apellido_materno %>"
  >
    <% }) %>
  </option>
</datalist>

<datalist id="listaAreas">
  <% (areas || []).forEach(d => { %>
  <option value="<%= d.nombre %>"><% }) %></option>
</datalist>

<datalist id="listaDepartamentos">
  <option value="Sistemas">
  <option value="Compras">
  <!-- Agrega más aquí si los tienes -->
</datalist>
<!-- Cargamos el script con lógica de agregar filas -->
<!--<script src="/js/proyecto.js"></script>-->
